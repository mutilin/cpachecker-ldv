<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE project> <!-- generic AcceptAllDTD to make the Eclipse Warning go away -->
<project name="AutomatonParserGeneration" default="generate" basedir="./../../../../../../">
  <!-- basedir should be the "CPAchecker" directory -->
  <property name="parserDir" location="src/org/sosy_lab/cpachecker/cpa/automaton/" />
  <property name="src"       location="src" />
  <property name="lib"       location="lib" />
  <property environment="env" />

  <taskdef name="jflex"
           classname="JFlex.anttask.JFlexTask"
           classpath="${lib}/build-only/JFlex.jar"
  />
  <taskdef name="cup"
           classname="java_cup.anttask.CUPTask"
           classpath="${lib}/java-cup-11a.jar"
  />

  <target name="echos">
  	<echo>${lib}</echo>
  	<echo>${src}</echo>
  	<echo>${parserDir}</echo>
  	<echo>${basedir}</echo>
  </target>

  <target name="generate">
    <cup srcfile="${parserDir}/parser.cup"
         destdir="${src}"
         interface="true"
         parser="AutomatonParser"
    	 symbols="AutomatonSym"
    	 nopositions="true"
    />

    <jflex file="${parserDir}/Scanner.jflex" destdir="${src}" skel="src/org/sosy_lab/cpachecker/cpa/automaton/skeleton.nested"/>

    <!-- remove generation date to not interfere with SVN -->
    <replaceregexp match="(Mon|Tue|Wed|Thu|Fri|Sat|Sun) \w\w\w \d\d \d\d:\d\d:\d\d \w+ \d\d\d\d" replace="[date omitted]" flags="g">
	<fileset dir="${parserDir}">
	    <include name="AutomatonParser.java"/>
	    <include name="AutomatonSym.java"/>
	</fileset>
    </replaceregexp>
    <replaceregexp file="${parserDir}/AutomatonScanner.java" match="\d\d\.\d\d.\d\d \d\d:\d\d" replace="[date omitted]" flags="g" />
    <replaceregexp file="${parserDir}/AutomatonScanner.java" match="(.tt>).*/(src/org/sosy_lab/cpachecker/cpa/automaton/Scanner.jflex./tt>)" replace="\1\2" />

    <!-- places the suppressWarnings-tag in front of the outer class -->
    <replace file="${parserDir}/AutomatonParser.java" token="public class " value="@SuppressWarnings(value = { &quot;all&quot; }) public  class "/>
    <!-- places the suppressWarnings-tag in front of the inner class -->
    <replace file="${parserDir}/AutomatonParser.java" token="class CUP$" value="@SuppressWarnings(value = { &quot;all&quot; }) class  CUP$"/>
  	<!-- SVN had "inconsistent line endings"-Problems. Let ANT fix it, uses the system default line ending -->
  	<fixcrlf file="${parserDir}/AutomatonParser.java" />
  </target>
</project>
